function getOffsetTop(t){for(var i=t.offsetTop,e=t.offsetParent;null!==e;)i+=e.offsetTop,e=e.offsetParent;return i}(function(t,i,e,n){var s=function(n,s){this.elem=n,this.$elem=t(n),this.options=s,this.metadata=this.$elem.data("plugin-options"),this.$win=t(i),this.sections={},this.didScroll=!1,this.$doc=t(e),this.docHeight=this.$doc.height()};s.prototype={defaults:{navItems:"a",currentClass:"current",changeHash:!1,easing:"swing",filter:"",scrollSpeed:750,scrollOffset:0,scrollThreshold:.5,begin:!1,end:!1,scrollChange:!1,padding:0,navScrollSpeed:300},init:function(){return this.config=t.extend({},this.defaults,this.options,this.metadata),this.$nav=this.$elem.find(this.config.navItems),""!==this.config.filter&&(this.$nav=this.$nav.filter(this.config.filter)),this.$nav.on("click.onePageNav",t.proxy(this.handleClick,this)),this.getPositions(),this.bindInterval(),this.$win.on("resize.onePageNav",t.proxy(this.getPositions,this)),this},adjustNav:function(t,i){t.$elem.find("."+t.config.currentClass).removeClass(t.config.currentClass),i.addClass(t.config.currentClass)},bindInterval:function(){var t,i=this;i.$win.on("scroll.onePageNav",function(){i.didScroll=!0}),i.t=setInterval(function(){t=i.$doc.height(),i.didScroll&&(i.didScroll=!1,i.scrollChange()),t!==i.docHeight&&(i.docHeight=t,i.getPositions())},250)},getHash:function(t){return t.attr("href").split("#")[1]},getPositions:function(){var i,e,n,s=this;s.$nav.each(function(){i=s.getHash(t(this)),(n=t("#"+i)).length&&(e=n.offset().top,s.sections[i]=Math.round(e))})},getSection:function(i){var e=null,n=Math.round(this.$win.height()*this.config.scrollThreshold);if(this.config.endSelector&&i>=getOffsetTop(t(this.config.endSelector)[0])+t(this.config.endSelector).height())return null;for(var s in this.sections){if(!(this.sections[s]-this.config.padding-this.config.scrollOffset-n<i))break;e=s}return e},handleClick:function(e){var n=this,s=t(e.currentTarget),o=s.parent(),l="#"+n.getHash(s),h=o[0].offsetTop-n.$elem.height()/2;o.hasClass(n.config.currentClass)||(n.config.begin&&n.config.begin(),n.adjustNav(n,o),n.unbindInterval(),n.scrollTo(l,function(){n.config.changeHash&&(i.location.hash=l),n.$elem.animate({scrollTop:h},n.config.navScrollSpeed),n.bindInterval(),n.config.end&&n.config.end()})),e.preventDefault()},scrollChange:function(){var i,e=this.$win.scrollTop(),n=this.getSection(e);if(null!==n){if(!(i=this.$elem.find('a[href$="#'+n+'"]').parent()).hasClass(this.config.currentClass)){var s=i[0].offsetTop-this.$elem.height()/2;this.$elem.animate({scrollTop:s},this.config.navScrollSpeed),this.adjustNav(this,i),this.config.scrollChange&&this.config.scrollChange(i)}}else(i=this.$elem.find("."+this.config.currentClass)).removeClass(this.config.currentClass),s=0,this.config.endSelector&&e>getOffsetTop(t(this.config.endSelector)[0])+t(this.config.endSelector).height()&&(s=this.$nav.last().parent()[0].offsetTop),s!=this.$elem.scrollTop()+this.$elem.height()-this.$nav.last().parent().height()&&this.$elem.animate({scrollTop:s},this.config.navScrollSpeed)},scrollTo:function(i,e){var n=t(i).offset().top-this.config.padding-this.config.scrollOffset;t("html, body").animate({scrollTop:n},this.config.scrollSpeed,this.config.easing,e)},unbindInterval:function(){clearInterval(this.t),this.$win.unbind("scroll.onePageNav")}},s.defaults=s.prototype.defaults,t.fn.onePageNav=function(t){return this.each(function(){new s(this,t).init()})}})(jQuery,window,document);